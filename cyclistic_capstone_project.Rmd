---
title: "Cyclistic Bike-Share Analysis"
author: "Rodrigo Willrich Gehlen"
date: "Completed: 2025-07-16<br>Last updated: `r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
---

## About Cyclistic

In 2016, Cyclistic launched a successful bike-share offering. Since then, the program has grown
to a fleet of 5,824 bicycles that are geotracked and locked into a network of 692 stations across
Chicago. The bikes can be unlocked from one station and returned to any other station in the
system anytime.

Until now, Cyclistic’s marketing strategy relied on building general awareness and appealing to
broad consumer segments. One approach that helped make these things possible was the
flexibility of its pricing plans: single-ride passes, full-day passes, and annual memberships.
Customers who purchase single-ride or full-day passes are referred to as casual riders.
Customers who purchase annual memberships are Cyclistic members.

---

## Ask

### Business Task

The Cyclistic marketing team wants to understand how **casual riders** and **annual members** use Cyclistic bikes differently. The goal is to design a marketing strategy that **converts casual riders into annual members**, improving long-term revenue and engagement.

---

## Prepare

### Data Source

The data is collected from City of Chicago's Divvy bycicle sharing service and made available by Motivate International Inc. under this [license](https://divvybikes.com/data-license-agreement). This service is operated by Lyft Bikes and Scooters, LLC. This analysis is based on historical data from 2019 and 2020.

The yearly data is originally organized in separate tables containing the following:

- 2019 trips: 365.069 observations and 12 variables
- 2020 trips: 426.887 observations and 14 variables

Each row represents a single ride.

Original data is publicly available at [this link](https://divvy-tripdata.s3.amazonaws.com/index.html).

The raw Divvy datasets are not stored in this repository due to file size limits.

If you'd like to **run the code in the R Markdown file**, please:

1. Download the datasets from the links below:
   - [trips_2019_q1.csv](https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2019_Q1.zip)
   - [trips_2020_q1.csv](https://divvy-tripdata.s3.amazonaws.com/Divvy_Trips_2020_Q1.zip)
2. Unzip and place the `.csv` files into the `data/` folder at the root of this repository. Make sure the names match those expected in the R script.

This will ensure the R Markdown code runs without errors.

---

## Process

### Setting Up

```{r check-data, echo=FALSE}
# Check if folder exists
if (!dir.exists("data")) {
  stop("Data folder not found. Please create a 'data/' folder and store the required data.")
}

# Check if files exists
files_needed <- c(
  "data/trips_2019_q1.csv",
  "data/trips_2020_q1.csv"
)
if (!all(file.exists(files_needed))) {
  stop("One or more files missing. Please ensure all required data are downloaded.")
}
```

Load libraries and read both dataframes:

```{r setup, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)

trips_2019 <- read.csv("data/trips_2019_q1.csv")
trips_2020 <- read.csv("data/trips_2020_q1.csv")
```

### Combining Data

This will allow to take every step of cleaning processes at once.

Before running the `bind_rows` function, it is important to ensure that **variables do have exactly the same name** and its **data is stored as the same type**:

```{r matching-names, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
trips_2019 <- trips_2019 %>%
  rename(
    ride_id = trip_id,
    started_at = start_time,
    ended_at = end_time,
    start_station_name = from_station_name,
    start_station_id = from_station_id,
    end_station_name = to_station_name,
    end_station_id = to_station_id,
    member_casual = usertype
  )
```

```{r matching-data-types, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
trips_2019 <- trips_2019 %>%
  mutate(ride_id = as.character(ride_id))
```

In order to identify each data source after combining, a new variable `year` were created:

```{r identifying-data, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
trips_2019 <- trips_2019 %>%
  mutate(year = "2019")
trips_2020 <- trips_2020 %>%
  mutate(year = "2020")
```

Unnecessary columns were removed to save memory usage as well:

```{r removing-variables, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
trips_2019 <- trips_2019 %>%
  select(
    -bikeid,
    -gender,
    -birthyear
  )
trips_2020 <- trips_2020 %>%
  select(
    -rideable_type,
    -start_lat,
    -start_lng,
    -end_lat,
    -end_lng
  )
```

Now both dataframes are ready to be combined:

```{r combining, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
divvy_trips <- bind_rows(trips_2019, trips_2020)
```

### Cleaning Data

To make sure that any analysis will result in reliable information, **duplicates** and **missing values** have to be identified:

```{r duplicates-missing-values, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
sum(duplicated(divvy_trips$ride_id))
colSums(is.na(divvy_trips))
```

All of the `tripduration` missing values comes from 2020 table, so that variable were updated:

```{r tripduration-update, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
divvy_trips <- divvy_trips %>%
  mutate(tripduration = difftime(ended_at, started_at, "seconds"))
```

To prevent calculation issues, data types were also updated:

```{r datatypes-update, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
divvy_trips <- divvy_trips %>%
  mutate(
    started_at = ymd_hms(started_at),
    ended_at = ymd_hms(ended_at),
    tripduration = as.numeric(tripduration),
    member_casual = as.factor(member_casual)
  )
```

Note that `member_casual` factor now have four levels and need to be adjusted:

```{r factor-adjustment, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
divvy_trips <- divvy_trips %>%
  mutate(member_casual = recode(member_casual,
                                "Subscriber" = "member",
                                "Customer" = "casual"))
```

Numeric range of `tripduration` includes negative numbers that are all related to HQ QR station (ID 675). As the analysis will be focused on **customer rides**, those rows were removed:

```{r removing-noncustomer-rides, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
divvy_trips <- divvy_trips %>%
  filter(!(start_station_id == 675))
```

## Analyze

Descriptive analysis were conducted to understand how **casual riders** and **annual members** use Cyclistic bikes differently.

Be aware that trips shorter than 1 minute and longer than 2 hours were excluded only from analyses of trip duration to avoid skewed results. These extremes may reflect test rides, errors, or system anomalies, and would disproportionately impact means.

The total number of rides was calculated for each user type to understand the overall distribution between members and casual users:

```{r ride-distribution, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
divvy_trips %>%
  count(member_casual, name = "total_rides") %>%
  mutate(percent = round(100 * total_rides / sum(total_rides)))
```

The average trip duration was calculated for each user type to compare ride lengths and gain insight into how each group typically uses the service:

```{r duration-distribution, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
divvy_trips %>%
  filter(tripduration >= 60 & tripduration <= 1200) %>%
  group_by(member_casual) %>%
  summarise(avg_duration_min = round(mean(tripduration) / 60))
```

The proportion of round trips—where the start and end stations are the same—was calculated for each user type. This helps explore behavioral differences, such as whether rides are point-to-point or recreational loops:

```{r round-trips, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
divvy_trips %>%
  mutate(round_trip = start_station_id == end_station_id) %>%
  count(member_casual, round_trip) %>%
  group_by(member_casual) %>%
  mutate(percent = round(100 * n / sum(n))) %>%
  filter(round_trip)
```

The number of trips was summarized for each weekday and user type to examine weekly usage patterns and identify differences in ride frequency across the week:

```{r weekday-trips, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
divvy_trips %>%
  mutate(
    weekday = wday(started_at, label = TRUE, abbr = FALSE),
    weekday = factor(weekday, levels = c(
      "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"
    ))
  ) %>%
  group_by(weekday, member_casual) %>%
  summarise(total_trips = n(), .groups = "drop")
```

The average trip duration was calculated by weekday and user type to assess how ride length varies over the week and between user groups:

```{r weekday-duration, echo=TRUE, eval=TRUE, message=FALSE, warning=FALSE}
divvy_trips %>%
  filter(tripduration >= 60 & tripduration <= 1200) %>%
  mutate(
    weekday = wday(started_at, label = TRUE, abbr = FALSE),
    weekday = factor(weekday, levels = c(
      "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"
    ))
  ) %>%
  group_by(weekday, member_casual) %>%
  summarise(avg_duration_min = round(mean(tripduration) / 60), .groups = "drop")
```

---

## Share

### Ride Distribution by User Type

```{r ride-distribution-setup, echo=FALSE, message=FALSE, warning=FALSE}
total_trips <- divvy_trips %>%
  group_by(member_casual) %>%
  summarise(total_trips = sum(n()), .groups = "drop") %>%
  mutate(
    percent = total_trips / sum(total_trips),
    label = paste0(round(percent * 100), "%")
  ) %>%
  arrange(desc(member_casual)) %>%
  mutate(
    ymax = cumsum(total_trips),
    ymin = lag(ymax, default = 0),
    label_position = (ymin + ymax) / 2
  )
```

```{r ride-distribution-plot, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(total_trips, aes(x = "", y = total_trips, fill = member_casual)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +
  geom_text(aes(y = label_position, label = label), color = "white", size = 5) +
  labs(fill = "User Type") +
  theme_void()
```

The chart shows that members make up the vast majority of total rides, while casual users account for a much smaller share. This indicates that the service is primarily used by subscribed members, suggesting frequent or routine use, such as commuting.

### Average Trip Duration by User Type

```{r avg-tripduration-setup, echo=FALSE, message=FALSE, warning=FALSE}
avg_tripduration <- divvy_trips %>%
  filter(tripduration >= 60 & tripduration <= 1200) %>%
  group_by(member_casual) %>%
  summarise(avg_duration_min = round(mean(tripduration) / 60))
```

```{r avg-tripduration-plot, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(avg_tripduration, aes(member_casual, avg_duration_min, fill = member_casual)) +
  geom_col() +
  labs(
    x = NULL,
    y = "Average Duration (min)",
    fill = "User Type"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_blank())
```

Casual users have longer average trip duration compared to members. This supports the idea that casual users are more likely engaging in leisure or recreational rides, while members tend to take shorter trips, possibly for commuting or other regular purposes.

### Round Trips Percentage by User Type

```{r round-trips-setup, echo=FALSE, message=FALSE, warning=FALSE}
round_trip_percent <- divvy_trips %>%
  mutate(round_trip = start_station_id == end_station_id) %>%
  count(member_casual, round_trip) %>%
  group_by(member_casual) %>%
  mutate(percent = round(100 * n / sum(n))) %>%
  filter(round_trip)
```

```{r round-trips-plot, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(round_trip_percent, aes(x = member_casual, y = percent, fill = member_casual)) +
  geom_col() +
  labs(
    x = NULL,
    y = "Percent of Round Trips",
    fill = "User Type"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_blank())
```

A higher percentage of casual users' rides are round trips, whereas very few member rides start and end at the same station. This pattern further supports the assumption that casual users are more likely using the service for recreational activities, while members tend to use it for point-to-point travel such as commuting.

### Total Trips per Weekday by User Type

```{r weekday-trips-setup, echo=FALSE, message=FALSE, warning=FALSE}
weekday_trips <- divvy_trips %>%
  mutate(
    weekday = wday(started_at, label = TRUE, abbr = FALSE),
    weekday = factor(weekday, levels = c(
      "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"
    ))
  ) %>%
  group_by(weekday, member_casual) %>%
  summarise(total_trips = n(), .groups = "drop")
```

```{r weekday-trips-plot, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(weekday_trips, aes(x = weekday, y = total_trips, fill = member_casual)) +
  geom_col(position = "dodge") +
  labs(
    x = "Weekday",
    y = "Number of Trips",
    fill = "User Type"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Members show consistent ride activity throughout the weekdays, with noticeable peaks on typical workdays, suggesting commuting behavior. In contrast, casual users are most active during weekends, indicating that their usage is likely driven by leisure and non-work-related purposes.

### Average Trip Duration per Weekday by User Type

```{r weekday-duration-setup, echo=FALSE, message=FALSE, warning=FALSE}
weekday_duration <- divvy_trips %>%
  filter(tripduration >= 60 & tripduration <= 1200) %>%
  mutate(
    weekday = wday(started_at, label = TRUE, abbr = FALSE),
    weekday = factor(weekday, levels = c(
      "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"
    ))
  ) %>%
  group_by(weekday, member_casual) %>%
  summarise(avg_duration_min = round(mean(tripduration) / 60), .groups = "drop")
```

```{r weekday-duration-plot, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(weekday_duration, aes(x = weekday, y = avg_duration_min, fill = member_casual)) +
  geom_col(position = "dodge") +
  labs(
    x = "Weekday",
    y = "Average Duration (min)",
    fill = "User Type"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

The average trip duration for casual users is consistently higher than for members across all weekdays, with the longest durations observed on weekends. This trend aligns with the idea that casual users take longer, recreational trips, while members maintain shorter, more routine ride lengths during the workweek.

### Key Findings

- Members dominate total ride volume
- Casual users take longer trips
- Round trips are more common among casual users
- Members ride more on weekdays; casual users on weekends
- Trip durations are longest on weekends for casual users

---

## Act

### Recommendations Based on Analysis

1. **Offer targeted membership promotions to casual users.**
Create time-limited discounts or free trial periods for casual riders, especially after their second or third ride, to encourage commitment while the service is still top-of-mind.

2. **Enhance the value of membership for leisure-focused users.**
Highlight membership benefits that appeal to casual riders — such as unlimited rides, weekend access, or bundled tourist/local perks — through in-app messaging or email campaigns.

3. **Analyze and improve station placement in high-leisure areas.**
Ensure casual users have a smooth, convenient experience by expanding or optimizing station coverage near parks, waterfronts, and event areas — making it easier for them to envision regular use and see value in upgrading.

### Next Steps

Future analysis could incorporate external data sources such as weather conditions, trip distances, or app engagement metrics to develop more targeted conversion strategies. A/B testing different promotional offers for casual users could also help evaluate which incentives most effectively encourage membership.
